services:
  evcc:
    # Use the official image for the server deployment or build locally
    # image: evcc/evcc:latest
    build: 
      context: .
      dockerfile: Dockerfile
    container_name: evcc
    restart: unless-stopped
    ports:
      - "7070:7070" # UI and API
      - "8887:8887" # OCPP
      - "5353:5353/udp" # mDNS
      - "4712:4712" # EEBUS
    volumes:
      - ./evcc.yaml:/etc/evcc.yaml
      - ./miele.json:/app/miele.json
      - ./data:/var/lib/evcc
    network_mode: "host" # Recommended for mDNS and hardware integration discovery
    environment:
      - EVCC_DATABASE_DSN=/var/lib/evcc/evcc.db
    develop:
      watch:
        - path: evcc.yaml
          action: restart
        - path: miele.json
          action: sync
          target: /app/miele.json
        - path: .
          action: rebuild
          ignore:
            - node_modules/
            - .git/
            - data/
            - dist/
